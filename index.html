<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Word Wolfï¼ˆå€‹åˆ¥URLé…å¸ƒï¼‰</title>

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
      background: #0b0c10;
      color: #eaf0ff;
    }
    .wrap {
      max-width: 980px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 { font-size: 22px; margin: 0 0 12px; }
    h2 { font-size: 18px; margin: 0 0 8px; }
    .card {
      background: #141824;
      border: 1px solid #27304a;
      border-radius: 16px;
      padding: 16px;
      margin: 12px 0;
    }
    label {
      display: block;
      margin: 10px 0 6px;
      opacity: .9;
    }
    input, select, button, textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #2b3757;
      background: #0f1320;
      color: #eaf0ff;
    }
    button {
      cursor: pointer;
      font-weight: 700;
    }
    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    .pill {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      background: #1e2a49;
      border: 1px solid #32406a;
      font-size: 12px;
    }
    .muted {
      opacity: .75;
      font-size: 13px;
      line-height: 1.5;
    }
    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    }
    .big {
      font-size: 28px;
      font-weight: 800;
      margin: 6px 0 10px;
    }
    .linkrow {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-top: 8px;
    }
    .linkrow input { flex: 1; }
    .copybtn { width: auto; padding: 8px 12px; }
    textarea {
      min-height: 220px;
      resize: vertical;
    }
  </style>
</head>

<body>
<div class="wrap">
  <h1>ğŸº Word Wolfï¼ˆå€‹åˆ¥URLé…å¸ƒï¼‰</h1>

  <!-- å¸ä¼šç”»é¢ -->
  <div id="hostView" class="card" hidden>
    <h2>å¸ä¼šç”»é¢</h2>
    <p class="muted">
      äººæ•°ãƒ»ã‚¦ãƒ«ãƒ•äººæ•°ãƒ»ãŠé¡Œã‚’é¸ã‚“ã§ã€Œç”Ÿæˆã€ã€‚<br>
      å‡ºãŸURLã‚’å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¸é…å¸ƒã—ã¦ãã ã•ã„ã€‚
    </p>

    <div class="row">
      <div>
        <label>å‚åŠ äººæ•°ï¼ˆ2ã€œ12ï¼‰</label>
        <input id="playerCount" type="number" min="2" max="12" value="5">
      </div>
      <div>
        <label>ã‚¦ãƒ«ãƒ•äººæ•°</label>
        <select id="wolfCount">
          <option value="1" selected>1äºº</option>
          <option value="2">2äºº</option>
          <option value="3">3äºº</option>
        </select>
      </div>
    </div>

    <label>ãŠé¡Œãƒšã‚¢ï¼ˆå¸‚æ°‘ / ã‚¦ãƒ«ãƒ•ï¼‰</label>
    <select id="pairSelect"></select>

    <button id="genBtn">ğŸ´ å€‹åˆ¥URLã‚’ç”Ÿæˆ</button>

    <div id="result" class="card" hidden>
      <h2>ä¸€æ‹¬ã‚³ãƒ”ãƒ¼ï¼ˆè¡Œé–“åºƒã‚ï¼‰</h2>
      <textarea id="bulkText" class="mono" readonly></textarea>
      <div class="linkrow">
        <button id="bulkCopyBtn" class="copybtn">ä¸€æ‹¬ã‚³ãƒ”ãƒ¼</button>
        <button id="bulkSelectBtn" class="copybtn">å…¨é¸æŠ</button>
      </div>

      <h2 style="margin-top:16px;">å€‹åˆ¥ã‚³ãƒ”ãƒ¼</h2>
      <div id="links"></div>
    </div>
  </div>

  <!-- ã‚«ãƒ¼ãƒ‰ç”»é¢ -->
  <div id="cardView" class="card" hidden>
    <h2>ã‚ãªãŸã®ã‚«ãƒ¼ãƒ‰</h2>
    <span id="rolePill" class="pill"></span>
    <div class="big" id="topicText"></div>
    <div class="muted" id="metaText"></div>

    <div class="card">
      <div class="muted">
        â€» ã“ã®ç”»é¢ã¯OBSã«æ˜ ã•ãªã„ã§ãã ã•ã„ã€‚<br>
        â€» è‡ªåˆ†ã®URLã ã‘é–‹ã„ã¦ãã ã•ã„ã€‚
      </div>
    </div>
  </div>
</div>

<script>
/* ===== ãŠé¡Œï¼ˆ15å•ï¼‰ ===== */
const PAIRS = [
  { citizen:"ãŠæ­£æœˆ", wolf:"ä¼‘æ—¥" },
  { citizen:"åˆè©£", wolf:"ãŠå‚ã‚Š" },
  { citizen:"ãŠå¹´ç‰", wolf:"ãƒœãƒ¼ãƒŠã‚¹" },
  { citizen:"æ­£æœˆå¤ªã‚Š", wolf:"é£Ÿã¹éã" },
  { citizen:"æ–°å¹´ã®ç›®æ¨™", wolf:"ã‚„ã‚ŠãŸã„ã“ã¨" },

  { citizen:"å¥½ããªäºº", wolf:"æ°—ã«ãªã‚‹äºº" },
  { citizen:"å‘Šç™½", wolf:"ãƒ—ãƒ­ãƒãƒ¼ã‚º" },
  { citizen:"ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚­ã‚¹", wolf:"åˆä½“é¨“" },
  { citizen:"æ‹äººã«ã—ãŸã„ã‚¿ã‚¤ãƒ—", wolf:"çµå©šã—ãŸã„ã‚¿ã‚¤ãƒ—" },
  { citizen:"å®‰å¿ƒã§ãã‚‹äºº", wolf:"åˆºæ¿€çš„ãªäºº" },

  { citizen:"é»’æ­´å²", wolf:"ãƒˆãƒ©ã‚¦ãƒ" },
  { citizen:"å¯‚ã—ã„ã“ã¨", wolf:"æ‚”ã—ã„ã“ã¨" },
  { citizen:"æ™®é€š", wolf:"ç•°å¸¸" },
  { citizen:"äººç”Ÿã¨ã¯", wolf:"å¤¢ã¨ã¯" },
  { citizen:"ç‰‡æ€ã„", wolf:"ã‚¹ãƒˆãƒ¼ã‚«ãƒ¼" },
];

const $ = id => document.getElementById(id);

/* ===== å®‰å…¨ãªBase64ï¼ˆæ—¥æœ¬èªOKï¼‰ ===== */
function b64e(obj){
  const json = JSON.stringify(obj);
  const bytes = new TextEncoder().encode(json);
  let binary = "";
  const chunk = 0x8000;
  for(let i=0;i<bytes.length;i+=chunk){
    binary += String.fromCharCode(...bytes.subarray(i, i+chunk));
  }
  return btoa(binary);
}
function b64d(str){
  const binary = atob(str);
  const bytes = new Uint8Array(binary.length);
  for(let i=0;i<binary.length;i++) bytes[i] = binary.charCodeAt(i);
  const json = new TextDecoder().decode(bytes);
  return JSON.parse(json);
}

function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

/* ===== ãƒ¢ãƒ¼ãƒ‰åˆ¤å®š ===== */
const url = new URL(location.href);
const cardParam = url.searchParams.get("card");

if(cardParam){
  $("cardView").hidden = false;
  const data = b64d(decodeURIComponent(cardParam));
  $("rolePill").textContent = data.role==="WOLF" ? "ğŸº ã‚¦ãƒ«ãƒ•" : "ğŸ‘¤ å¸‚æ°‘";
  $("topicText").textContent = data.topic;
  $("metaText").textContent = `ã‚ãªãŸï¼šPlayer ${data.pIndex}`;
}else{
  $("hostView").hidden = false;
  PAIRS.forEach((p,i)=>{
    const o=document.createElement("option");
    o.value=i;
    o.textContent=`${p.citizen} / ${p.wolf}`;
    $("pairSelect").appendChild(o);
  });

  $("genBtn").onclick = ()=>{
    const n = Number($("playerCount").value);
    const w = Math.min(n-1, Number($("wolfCount").value));
    const pair = PAIRS[$("pairSelect").value];

    const roles = shuffle(
      Array.from({length:n},(_,i)=>i<w?"WOLF":"CITIZEN")
    );

    $("links").innerHTML="";
    const bulk=[];

    roles.forEach((r,i)=>{
      const payload = {
        role:r,
        topic: r==="WOLF"?pair.wolf:pair.citizen,
        pIndex:i+1
      };
      const card = encodeURIComponent(b64e(payload));
      const link = location.origin+location.pathname+"?card="+card;

      bulk.push(`ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${i+1}\n${link}\n\n`);

      const row=document.createElement("div");
      row.className="card";
      row.innerHTML=`
        <div class="pill">Player ${i+1}</div>
        <div class="linkrow">
          <input class="mono" readonly value="${link}">
          <button class="copybtn">ã‚³ãƒ”ãƒ¼</button>
        </div>`;
      row.querySelector("button").onclick=()=>{
        navigator.clipboard.writeText(link);
      };
      $("links").appendChild(row);
    });

    $("bulkText").value = bulk.join("").trim()+"\n";
    $("result").hidden=false;
  };

  $("bulkCopyBtn").onclick=()=>{
    navigator.clipboard.writeText($("bulkText").value);
  };
  $("bulkSelectBtn").onclick=()=>{
    $("bulkText").select();
  };
}
</script>
</body>
</html>
